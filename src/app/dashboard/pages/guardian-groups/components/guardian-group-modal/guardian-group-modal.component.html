<ng-container *ngIf="isFormReady$ | async; else formLoadingTpl">
  <form nz-form [formGroup]="groupForm" nzLayout="vertical" novalidate>
    <div nz-row [nzGutter]="[24, 12]">
      <div nz-col [nzSpan]="12">
        <nz-form-item>
          <app-form-label fullWidth="false">
            <nz-form-label nzFor="name" nzRequired
            >Group name
            </nz-form-label>
          </app-form-label>
          <nz-form-control
            [nzErrorTip]="nameErrorTpl"
          >
            <input
              id="name"
              nzSize="default"
              type="text"
              nz-input
              formControlName="name"
              placeholder="Insert group name"
            />
          </nz-form-control>
          <ng-template #nameErrorTpl let-control>
            <ng-container *ngIf="control.hasError('required')">
              <span nz-typography nzType="danger">
                Please enter name of group!
              </span>
            </ng-container>
            <ng-container *ngIf="control.hasError('min')">
              <span nz-typography nzType="danger">
                Name of group should be at least {{ nameMinLength }} characters long
              </span>
            </ng-container>
            <ng-container *ngIf="control.hasError('max')">
              <span nz-typography nzType="danger">
                Name of group should be at most {{ nameMaxLength }} characters long
              </span>
            </ng-container>
          </ng-template>
        </nz-form-item>
      </div>
      <div nz-col [nzSpan]="4" [nzOffset]="2">
        <nz-form-item>
          <app-form-label>
            <nz-form-label nzFor="priority" nzRequired
            >Priority
            </nz-form-label
            >
          </app-form-label>
          <nz-form-control [nzErrorTip]="priorityErrorTpl">
            <nz-input-number
              [nzMin]="priorityMin"
              [nzMax]="priorityMax"
              [nzStep]="1"
              formControlName="priority"
              nzPlaceHolder="Insert priority"
              nzPrecisionMode="cut"
            >
            </nz-input-number>
          </nz-form-control>
          <ng-template #priorityErrorTpl let-control>
            <ng-container *ngIf="control.hasError('required')">
            <span nz-typography nzType="danger">
              Please enter priority of group!
            </span>
            </ng-container>
            <ng-container *ngIf="control.hasError('min')">
            <span nz-typography nzType="danger">
              Priority should be at least {{ priorityMin }}
            </span>
            </ng-container>
            <ng-container *ngIf="control.hasError('max')">
            <span nz-typography nzType="danger">
              Priority should be at most {{ priorityMax }}
            </span>
            </ng-container>
          </ng-template>
        </nz-form-item>
      </div>
      <div nz-col [nzSpan]="2" [nzOffset]="2">
        <nz-form-item>
          <app-form-label>
            <nz-form-label nzFor="active" nzRequired>Active</nz-form-label>
          </app-form-label>
          <nz-form-control>
            <nz-switch id="active" formControlName="active"></nz-switch>
          </nz-form-control>
        </nz-form-item>
      </div>
      <div nz-col [nzSpan]="2">
        <nz-form-item>
          <app-form-label>
            <nz-form-label nzFor="default" nzRequired>Default</nz-form-label>
          </app-form-label>
          <nz-form-control>
            <nz-switch id="default" formControlName="default"></nz-switch>
          </nz-form-control>
        </nz-form-item>
      </div>
    </div>
    <app-guardian-group-permissions-form formControlName="permissions">
    </app-guardian-group-permissions-form>
  </form>
</ng-container>

<ng-template #formLoadingTpl>
  <nz-spin nzSimple class="text-center"></nz-spin>
</ng-template>

<ng-template #modalTitleTpl>
  <app-modal-header>
    <nz-space>
      <nz-space-item>
        <h4 nz-typography nzType="secondary" class="text-capitalize">
          Create new group
        </h4>
      </nz-space-item>
      <nz-space-item>
        <app-popover-helper
          placement="right"
          [popoverContent]="modalTitleHelperTpl"
        ></app-popover-helper>
      </nz-space-item>
    </nz-space>
  </app-modal-header>
  <ng-template #modalTitleHelperTpl>
    Create group definition, define its permissions and add users after creating the group
  </ng-template>
</ng-template>

<div *nzModalFooter>
  <button
    class="text-capitalize"
    nz-button
    nzType="primary"
    [nzLoading]="isLoading$ | async"
    [disabled]="(isFormReady$ | async) === false || (isLoading$ | async) || !groupForm.valid"
    (click)="submitForm($event)"
  >
    Create new group
  </button>
</div>
